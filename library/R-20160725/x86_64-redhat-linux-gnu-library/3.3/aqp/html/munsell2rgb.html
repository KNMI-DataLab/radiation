<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Convert Munsell Notation to and from RGB color coordinates</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for munsell2rgb {aqp}"><tr><td>munsell2rgb {aqp}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>
Convert Munsell Notation to and from RGB color coordinates
</h2>

<h3>Description</h3>

<p>Color conversion based on a look-up table of common soil colors.
</p>


<h3>Usage</h3>

<pre>
munsell2rgb(the_hue, the_value, the_chroma, alpha=1, 
maxColorValue=1, return_triplets=FALSE)
rgb2munsell(color)
parseMunsell(munsellColor, convertColors=TRUE, ...)
getClosestMunsellChip(munsellColor, convertColors=TRUE, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>the_hue</code></td>
<td>
<p>a vector of one or more more hues, upper-case</p>
</td></tr>
<tr valign="top"><td><code>the_value</code></td>
<td>
<p>a vector of one or more values</p>
</td></tr>
<tr valign="top"><td><code>the_chroma</code></td>
<td>
<p>a vector of one or more chromas, may be NA for neutral hues</p>
</td></tr>
<tr valign="top"><td><code>alpha</code></td>
<td>
<p>alpha channel value (for transparency effects)</p>
</td></tr>
<tr valign="top"><td><code>maxColorValue</code></td>
<td>
<p>maximum RGB color value (see <code><a href="../../grDevices/html/rgb.html">rgb</a>)</code></p>
</td></tr>
<tr valign="top"><td><code>return_triplets</code></td>
<td>
<p>should the function return raw RGB triplets instead of an R color</p>
</td></tr>
<tr valign="top"><td><code>color</code></td>
<td>
<p>a <code>data.frame</code> or <code>matrix</code> object containing color-space coordinates: [R, G, B]</p>
</td></tr>
<tr valign="top"><td><code>munsellColor</code></td>
<td>
<p>character vector of strings containing Musell colors, e.g. '10YR 4/3'</p>
</td></tr>
<tr valign="top"><td><code>convertColors</code></td>
<td>
<p>logical, should parsed Munsell colors be converted into RGB values</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>further arguments to <code>munsell2rgb</code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>These functions generalize to vectorized usage, as long as the length of each argument is the same. Both functions will pad output with NA if there are any NA present in the inputs.
</p>
<p>Neutral hues are approximated by greyscale shades ranging from 20% (darker) to 80% (lighter). No chroma is required for neutral hues.
</p>
<p>Gley soil colors that are missing a chroma will not be correctly interpreted. Consider using a chroma of 1.
</p>
<p>Values of &quot;2.5&quot; (common in soil color descriptions) are silently truncated to &quot;2&quot;.
</p>
<p>Non-standard Munsell colors (e.g. '7.9YR 2.7/2.0') can be matched (nearest-neighbor, no interpolation) to the closest color within the 'munsell' RGB look-up table via <code>getClosestMunsellChip()</code>. See examples below.
</p>


<h3>Value</h3>

<p>For Munsell to RGB conversion, a vector of R colors is returned that is the same length as the input data. If <code>return_triplets</code> is <code>TRUE</code>, then a dataframe (of sample length as input) of r,g,b values is returned.
</p>
<p>For RGB to Munsell conversion, a dataframe (NA-padded) of hue, value, chroma, and Euclidean distance to nearest matching color is returned.
</p>


<h3>Note</h3>

<p>Care should be taken when using the resulting RGB values; they are close to their Munsell counterparts, but will vary based on your monitor and ambient lighting conditions. Also, the value used for <code>maxColorValue</code> will affect the brightness of the colors. Th default value (1) will usually give acceptable results, but can be adjusted to force the colors closer to what the user thinks they should look like.</p>


<h3>Author(s)</h3>

<p>D.E. Beaudette</p>


<h3>References</h3>

<p><a href="http://ncss-tech.github.io/AQP/">http://ncss-tech.github.io/AQP/</a>
<a href="http://www.brucelindbloom.com/index.html?ColorCalcHelp.html">http://www.brucelindbloom.com/index.html?ColorCalcHelp.html</a>
<a href="http://www.cis.rit.edu/mcsl/online/munsell.php">http://www.cis.rit.edu/mcsl/online/munsell.php</a>
<a href="http://www.munsellcolourscienceforpainters.com/MunsellAndKubelkaMunkToolbox/MunsellAndKubelkaMunkToolbox.html">http://www.munsellcolourscienceforpainters.com/MunsellAndKubelkaMunkToolbox/MunsellAndKubelkaMunkToolbox.html</a>
</p>


<h3>Examples</h3>

<pre>

# Munsell to RGB triplets: 
# function is vectorized as long as arguments are the same length
color &lt;- munsell2rgb(the_hue=c('10YR', '2.5YR'), the_value=c(3, 5), 
the_chroma=c(5, 6), return_triplets=TRUE)

# RGB triplets to closest Munsell color (in RGB space)
# function is vectorized
rgb2munsell(color)

# neutral heues (N) map to approximate greyscale colors
# chroma may be any number or NA
g &lt;- expand.grid(hue='N', value=2:8, chroma=NA, stringsAsFactors=FALSE)
munsell2rgb(g$hue, g$value, g$chroma)


# basic example: no factors!
d &lt;- expand.grid(hue='10YR', value=2:8, chroma=1:8, stringsAsFactors=FALSE)
d$color &lt;- with(d, munsell2rgb(hue, value, chroma))

# similar to the 10YR color book page
plot(value ~ chroma, data=d, col=d$color, pch=15, cex=3)

# multiple pages of hue:
hues &lt;- c('2.5YR','5YR','7.5YR','10YR')
d &lt;- expand.grid(hue=hues, value=2:8, chroma=seq(2,8,by=2), stringsAsFactors=FALSE)
d$color &lt;- with(d, munsell2rgb(hue, value, chroma))


# plot: note that we are setting panel order from red--&gt;yellow
library(lattice)
xyplot(value ~ factor(chroma) | factor(hue, levels=hues),
main="Common Soil Colors", layout=c(4,1), scales=list(alternating=1),
strip=strip.custom(bg=grey(0.85)),
data=d, as.table=TRUE, subscripts=TRUE, xlab='Chroma', ylab='Value',
panel=function(x, y, subscripts, ...)
{
panel.xyplot(x, y, pch=15, cex=4, col=d$color[subscripts])
}
)

# try again, this time annotate with LAB coordinates:
if(require(colorspace)) {
  d.rgb &lt;- with(d, munsell2rgb(hue, value, chroma, return_triplets=TRUE))
  d.lab &lt;- as(with(d.rgb, RGB(r,g,b)), 'LAB')
  d &lt;- data.frame(d, d.lab@coords)
  
  xyplot(value ~ factor(chroma) | factor(hue, levels=hues),
  main="Common Soil Colors - Annotated with LAB Coordinates", layout=c(4,1), 
  scales=list(alternating=1), strip=strip.custom(bg=grey(0.85)),
  data=d, as.table=TRUE, subscripts=TRUE, xlab='Chroma', ylab='Value',
  panel=function(x, y, subscripts, ...) {
    panel.xyplot(x, y, pch=15, cex=7, col=d$color[subscripts])
    lab.text &lt;- with(d[subscripts, ], paste(round(L), round(A), round(B), sep='\n'))
    panel.text(x, y, labels=lab.text, cex=0.75, col='white', font=2)
    }
  )
  
  # also demonstrate A ~ hue for each slice of chroma
  xyplot(A ~ factor(hue, levels=hues) | factor(value), groups=chroma, data=d,
  scales=list(alternating=1), strip=strip.custom(bg=grey(0.85)),
  main="A-coordinate vs. Munsell Hue", sub='panels are Munsell value, colors are Munsell chroma',
  xlab='Munsell Hue', ylab='A-coordinate', pch=16,
  type='b', as.table=TRUE, auto.key=list(lines=TRUE, points=FALSE, columns=4))
  
  }



# soils example
data(sp1)

# convert colors
sp1$soil_color &lt;- with(sp1, munsell2rgb(hue, value, chroma))

# simple plot, may need to tweak gamma-correction...
image(matrix(1:nrow(sp1)), axes=FALSE, col=sp1$soil_color, main='Soil Colors')

# convert into a more useful color space
# you will need the colorspace package for this to work
if(require(colorspace)) {
# keep RGB triplets from conversion
sp1.rgb &lt;- with(sp1, munsell2rgb(hue, value, chroma, return_triplets=TRUE))

# convert into LAB color space
sp1.lab &lt;- as(with(sp1.rgb, RGB(r,g,b)), 'LAB')
plot(sp1.lab)
}

# convert a non-standard color to closest "chip" in `munsell` look-up table
getClosestMunsellChip('7.9YR 2.7/2.0', convertColors = FALSE)
# convert directly to R color
getClosestMunsellChip('7.9YR 2.7/2.0')
</pre>

<hr /><div style="text-align: center;">[Package <em>aqp</em> version 1.9.10 <a href="00Index.html">Index</a>]</div>
</body></html>
