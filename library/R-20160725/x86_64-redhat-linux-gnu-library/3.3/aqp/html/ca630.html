<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Soil Data from the Central Sierra Nevada Region of California</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for ca630 {aqp}"><tr><td>ca630 {aqp}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Soil Data from the Central Sierra Nevada Region of California</h2>

<h3>Description</h3>

<p>Site and laboratory data from soils sampled in the central Sierra Nevada Region of California.</p>


<h3>Usage</h3>

<pre>data(ca630)</pre>


<h3>Format</h3>

<p>List containing:
</p>
<p>$site : A data frame containing site information.
</p>

<dl>
<dt><code>user_site_id</code></dt><dd><p>national user site id</p>
</dd>
<dt><code>mlra</code></dt><dd><p>the MLRA</p>
</dd>
<dt><code>county</code></dt><dd><p>the county</p>
</dd>
<dt><code>ssa</code></dt><dd><p>soil survey area</p>
</dd>
<dt><code>lon</code></dt><dd><p>longitude, WGS84</p>
</dd>
<dt><code>lat</code></dt><dd><p>latitude, WGS84</p>
</dd>
<dt><code>pedon_key</code></dt><dd><p>national soil profile id</p>
</dd>
<dt><code>user_pedon_id</code></dt><dd><p>local soil profile id</p>
</dd>
<dt><code>cntrl_depth_to_top</code></dt><dd><p>control section top depth (cm)</p>
</dd>
<dt><code>cntrl_depth_to_bot</code></dt><dd><p>control section bottom depth (cm)</p>
</dd>
<dt><code>sampled_taxon_name</code></dt><dd><p>soil series name</p>
</dd>
</dl>

<p>$lab : A data frame containing horizon information.
</p>

<dl>
<dt><code>pedon_key</code></dt><dd><p>national soil profile id</p>
</dd>
<dt><code>layer_key</code></dt><dd><p>national horizon id</p>
</dd>
<dt><code>layer_sequence</code></dt><dd><p>horizon sequence number</p>
</dd>
<dt><code>hzn_top</code></dt><dd><p>horizon top (cm)</p>
</dd>
<dt><code>hzn_bot</code></dt><dd><p>horizon bottom (cm)</p>
</dd>
<dt><code>hzn_desgn</code></dt><dd><p>horizon name</p>
</dd>
<dt><code>texture_description</code></dt><dd><p>USDA soil texture</p>
</dd>
<dt><code>nh4_sum_bases</code></dt><dd><p>sum of bases extracted by ammonium acetate (pH 7)</p>
</dd>
<dt><code>ex_acid</code></dt><dd><p>exchangeable acidity [method ?]</p>
</dd>
<dt><code>CEC8.2</code></dt><dd><p>cation exchange capacity by sum of cations method (pH 8.2)</p>
</dd>
<dt><code>CEC7</code></dt><dd><p>cation exchange capacity by ammonium acetate (pH 7)</p>
</dd>
<dt><code>bs_8.2</code></dt><dd><p>base saturation by sum of cations method (pH 8.2)</p>
</dd>
<dt><code>bs_7</code></dt><dd><p>base saturation by ammonium acetate (pH 7)</p>
</dd>
</dl>



<h3>Details</h3>

<p>These data were extracted from the NSSL database. 'ca630' is a list composed of site and lab data, each stored as dataframes. These data are modeled by a 1:many (site:lab) relation, with the 'pedon_id' acting as the primary key in the 'site' table and as the foreign key in the 'lab' table.</p>


<h3>Note</h3>

<p>These data are out of date. Pending some new data + documentation. Use with caution</p>


<h3>Source</h3>

<p><a href="http://ssldata.nrcs.usda.gov/">http://ssldata.nrcs.usda.gov/</a></p>


<h3>Examples</h3>

<pre>
## Not run: 
library(plyr)
library(lattice)
library(Hmisc)
library(maps)
library(sp)

# check the data out:
data(ca630)
str(ca630)

# note that pedon_key is the link between the two tables

# make a copy of the horizon data
ca &lt;- ca630$lab

# promote to a SoilProfileCollection class object
depths(ca) &lt;- pedon_key ~ hzn_top + hzn_bot

# add site data, based on pedon_key
site(ca) &lt;- ca630$site

# ID data missing coordinates: '|' is a logical OR
(missing.coords.idx &lt;- which(is.na(ca$lat) | is.na(ca$lon)))

# remove missing coordinates by safely subsetting
if(length(missing.coords.idx) &gt; 0)
	ca &lt;- ca[-missing.coords.idx, ]

# register spatial data
coordinates(ca) &lt;- ~ lon + lat

# assign a coordinate reference system
proj4string(ca) &lt;- '+proj=longlat +datum=NAD83'

# check the result
print(ca)

# map the data (several ways to do this, here is a simple way)
map(database='county', region='california')
points(coordinates(ca), col='red', cex=0.5)

# aggregate %BS 7 for all profiles into 1 cm slices
a &lt;- slab(ca, fm= ~ bs_7)

# plot median &amp; IQR by 1 cm slice
xyplot(
top ~ p.q50, data=a, lower=a$p.q25, upper=a$p.q75, 
ylim=c(160,-5), alpha=0.5, scales=list(alternating=1, y=list(tick.num=7)),
panel=panel.depth_function, prepanel=prepanel.depth_function,
ylab='Depth (cm)', xlab='Base Saturation at pH 7', 
par.settings=list(superpose.line=list(col='black', lwd=2))
)

# aggregate %BS at pH 8.2 for all profiles by MLRA, along 1 cm slices
# note that mlra is stored in @site
a &lt;- slab(ca, mlra ~ bs_8.2)

# keep only MLRA 18 and 22
a &lt;- subset(a, subset=mlra %in% c('18', '22'))

# plot median &amp; IQR by 1 cm slice, using different colors for each MLRA
xyplot(
top ~ p.q50, groups=mlra , data=a, lower=a$p.q25, upper=a$p.q75, 
ylim=c(160,-5), alpha=0.5, scales=list(y=list(tick.num=7, alternating=3), x=list(alternating=1)),
panel=panel.depth_function, prepanel=prepanel.depth_function,
ylab='Depth (cm)', xlab='Base Saturation at pH 8.2', 
par.settings=list(superpose.line=list(col=c('black','blue'), lty=c(1,2), lwd=2)),
auto.key=list(columns=2, title='MLRA', points=FALSE, lines=TRUE)
)


# safely compute hz-thickness weighted mean CEC (pH 7)
# using data.frame objects
head(lab.agg.cec_7 &lt;- ddply(ca630$lab, .(pedon_key), 
.fun=summarise, CEC_7=wtd.mean(bs_7, weights=hzn_bot-hzn_top)))

# extract a SPDF with horizon data along a slice at 25 cm
s.25 &lt;- slice(ca, fm=25 ~ bs_7 + CEC7 + ex_acid)
spplot(s.25, zcol=c('bs_7','CEC7','ex_acid'))

# note that the ordering is preserved:
all.equal(s.25$pedon_key, profile_id(ca))

# extract a data.frame with horizon data at 10, 20, and 50 cm
s.multiple &lt;- slice(ca, fm=c(10,20,50) ~ bs_7 + CEC7 + ex_acid)

# Extract the 2nd horizon from all profiles as SPDF
ca.2 &lt;- ca[, 2]

# subset profiles 1 through 10
ca.1.to.10 &lt;- ca[1:10, ]

# basic plot method: profile plot
plot(ca.1.to.10, name='hzn_desgn')

## End(Not run)
</pre>

<hr /><div style="text-align: center;">[Package <em>aqp</em> version 1.9.10 <a href="00Index.html">Index</a>]</div>
</body></html>
