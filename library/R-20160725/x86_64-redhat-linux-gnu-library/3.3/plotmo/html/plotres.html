<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Plot the residuals of a regression model</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for plotres {plotmo}"><tr><td>plotres {plotmo}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Plot the residuals of a regression model</h2>

<h3>Description</h3>

<p>Plot the residuals of a regression model.
</p>
<p>Please see the <a href="../doc/plotres-notes.pdf">plotres vignette</a>.
</p>


<h3>Usage</h3>

<pre>
plotres(object = stop("no 'object' argument"),
    which = 1:4, info = FALSE, versus = 1,
    standardize = FALSE, delever = FALSE, level = 0,
    id.n = 3, labels.id = NULL, smooth.col = 2,
    grid.col = 0, jitter = 0,
    do.par = NULL, caption = NULL, trace = 0,
    npoints = 3000, center = TRUE,
    type = NULL, nresponse = NA,
    object.name = quote.deparse(substitute(object)), ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>object</code></td>
<td>

<p>The model object.
</p>
</td></tr>
<tr valign="top"><td><code>which</code></td>
<td>

<p>Which plots do draw.  Default is <code>1:4</code>.
</p>
<p><code>1</code>  Model plot.  What gets plotted here depends on the model class.
For example, for <code>earth</code> models this is a model selection plot.
Nothing will be displayed for some models.
For details, please see the
<a href="../doc/plotres-notes.pdf">plotres vignette</a>.
</p>
<p><code>2</code>  Cumulative distribution of abs residuals
</p>
<p><code>3</code>  Residuals vs fitted
</p>
<p><code>4</code>  QQ plot
</p>
<p><code>5</code>  Abs residuals vs fitted
</p>
<p><code>6</code>  Sqrt abs residuals vs fitted
</p>
<p><code>7</code>  Abs residuals vs log fitted
</p>
<p><code>8</code>  Cube root of the squared residuals vs log fitted
</p>
<p><code>9</code>  Log abs residuals vs log fitted
<br />
<br />
</p>
</td></tr>
<tr valign="top"><td><code>info</code></td>
<td>

<p>Default is <code>FALSE</code>.
Use <code>TRUE</code> to print extra information as follows:




</p>
<p>i) Display the distribution of the residuals along the bottom of the plot.
</p>
<p>ii) Display the training R-Squared.
</p>
<p>iii) Display the Spearman Rank Correlation of the absolute residuals
with the fitted values.
Actually, correlation is measured against the absolute values
of whatever is on the horizontal
axis &mdash; by default this is the fitted response, but may be something
else if the <code>versus</code> argument is used.
</p>
<p>iv) In the Cumulative Distribution plot (<code>which=2</code>),
display additional information on the quantiles.
</p>
<p>v) Only for <code>which=5</code> or <code>9</code>.
Regress the absolute residuals against the fitted values
and display the regression slope.
Robust linear regression is used via <code><a href="../../MASS/html/rlm.html">rlm</a></code> in the MASS package.
</p>
<p>vi) Add various annotations to the other plots.
<br />
<br />
</p>
</td></tr>
<tr valign="top"><td><code>versus</code></td>
<td>

<p>What do we plot the residuals against?  One of:
</p>
<p><code>1</code> Default. Plot the residuals versus the fitted values
(or the log values when <code>which=7</code> to <code>9</code>).
</p>
<p><code>2</code> Residuals versus observation number,
after observations have been sorted on the fitted value.
Same as <code>versus=1</code>, except that the residuals are spaced
uniformly along the horizontal axis.
</p>
<p><code>3</code> Residuals versus the response.
</p>
<p><code>4</code> Residuals versus the hat leverages.
</p>
<p><code>"b:"</code> Residuals versus the basis functions.
Currently only supported for <code>earth</code>, <code>mda::mars</code>, and <code>gam::gam</code> models.
A optional <code><a href="../../base/html/regex.html">regex</a></code> can follow the <code>"b:"</code> to specify a subset of the
terms, e.g. <code>versus="b:wind"</code> will plot terms with <code>"wind"</code> in
their name.
</p>
<p>Else a character vector specifying which predictors to plot against.
<br />
Example 1: <code>versus=""</code> plots against all predictors (since the
regex <code>versus=""</code> matches anything).
<br />
Example 2: <code>versus=c("wind", "vis")</code> plots predictors
with <code>wind</code> or <code>vis</code> in their name.
<br />
Example 3: <code>versus=c("wind|vis")</code> equivalent to the above.
<br />
Note: These are <code><a href="../../base/html/regex.html">regex</a></code>s.
Thus <code>versus="wind"</code> will match all variables that have <code>"wind"</code>
in their names. Use <code>"^wind$"</code> to match only the variable named
<code>"wind"</code>.
<br />
<br />
</p>
</td></tr>
<tr valign="top"><td><code>standardize</code></td>
<td>

<p>Default is <code>FALSE</code>.
Use <code>TRUE</code> to standardize the residuals.
Only supported for some models, an error message will be issued otherwise.
<br />
Each residual is divided by by <code>se_i * sqrt(1 - h_ii)</code>,
where <code>se_i</code> is the standard error of prediction
and <code>h_ii</code> is the leverage (the diagonal entry of the hat matrix).
When the variance model holds, the standardized residuals are
homoscedastic with unity variance.
<br />
The leverages are obtained using <code><a href="../../stats/html/influence.measures.html">hatvalues</a></code>.
(For <code>earth</code> models the leverages are
for the linear regression of the response on the basis matrix <code>bx</code>.)
A standardized residual with a leverage of 1 is plotted as a star on the axis.
<br />
This argument applies to all plots where the residuals are used
(including the cumulative distribution and QQ plots, and to
annotations displayed by the <code>info</code> argument).
</p>
</td></tr>
<tr valign="top"><td><code>delever</code></td>
<td>

<p>Default is <code>FALSE</code>.
Use <code>TRUE</code> to &ldquo;de-lever&rdquo; the residuals.
Only supported for some models, an error message will be issued otherwise.
<br />
Each residual is divided by <code>sqrt(1 - h_ii)</code>.
See the <code>standardize</code> argument for details.
</p>
</td></tr>
<tr valign="top"><td><code>level</code></td>
<td>

<p>Draw estimated confidence or prediction interval bands at the given
<code>level</code>, if the model supports them.
<br />
Default is <code>0</code>, bands not plotted.
Else a fraction, for example <code>level=0.90</code>.
Example:</p>
<pre>    mod &lt;- lm(log(Volume)~log(Girth), data=trees)
    plotres(mod, level=.90)</pre>
<p>You can modify the color of the bands with <code>level.shade</code> and <code>level.shade2</code>.
<br />
See also &ldquo;<em>Prediction intervals</em>&rdquo; in the
<a href="../doc/plotmo-notes.pdf">plotmo vignette</a>
(but note that <code>plotmo</code> needs prediction intervals on <em>new</em>
data, whereas <code>plotres</code> requires only that the model supports
prediction intervals on the training data).
</p>
</td></tr>
<tr valign="top"><td><code>id.n</code></td>
<td>

<p>The largest <code>id.n</code> residuals will be labeled in the plot.
Default is <code>3</code>.
Special values <code>TRUE</code> and <code>-1</code> or mean all.<br />
If <code>id.n</code> is negative (but not <code>-1</code>)
the <code>id.n</code> most positive and most negative
residuals will be labeled in the plot.<br />
A current implementation restriction is that <code>id.n</code> is ignored
when there are more than ten thousand cases.
</p>
</td></tr>
<tr valign="top"><td><code>labels.id</code></td>
<td>

<p>Residual labels.
Only used if <code>id.n &gt; 0</code>.
Default is the case names, or the case numbers if the cases are unnamed.
</p>
</td></tr>
<tr valign="top"><td><code>smooth.col</code></td>
<td>

<p>Color of the smooth line through the residual points.
Default is <code>2</code>, red. Use <code>smooth.col=0</code> for no smooth line.
<br />
You can adjust the amount of smoothing with <code>smooth.f</code>.
This gets passed as <code>f</code> to <code><a href="../../stats/html/lowess.html">lowess</a></code>.
The default is <code>2/3</code>.
Lower values make the line more wiggly.
</p>
</td></tr>
<tr valign="top"><td><code>grid.col</code></td>
<td>

<p>Default is <code>0</code>, no grid.
Else add a background <code><a href="../../graphics/html/grid.html">grid</a></code>
of the specified color to the degree1 plots.
The special value <code>grid.col=TRUE</code> is treated as <code>"lightgray"</code>.
</p>
</td></tr>
</table>













<table summary="R argblock">
<tr valign="top"><td><code>jitter</code></td>
<td>

<p>Default is <code>0</code>, no jitter.
Passed as <code>factor</code> to <code><a href="../../base/html/jitter.html">jitter</a></code>
to jitter the plotted points horizontally and vertically.
Useful for discrete variables and responses, where the residual points
tend to be overlaid.
</p>
</td></tr>
<tr valign="top"><td><code>do.par</code></td>
<td>
<p>One of <code>NULL</code>, <code>FALSE</code>, <code>TRUE</code>, or <code>2</code>, as follows:
</p>
<p><code>do.par=NULL</code> (default). Same as <code>do.par=FALSE</code> if the
number of plots is one; else the same as <code>TRUE</code>.
</p>
<p><code>do.par=FALSE</code>. Use the current <code><a href="../../graphics/html/par.html">par</a></code> settings.
You can pass additional graphics parameters in the &ldquo;<code>...</code>&rdquo; argument.
</p>
<p><code>do.par=TRUE</code>. Start a new page and call <code><a href="../../graphics/html/par.html">par</a></code> as
appropriate to display multiple plots on the same page.
This automatically sets parameters like <code>mfrow</code> and <code>mar</code>.
You can pass additional graphics parameters in the &ldquo;<code>...</code>&rdquo; argument.



</p>
<p><code>do.par=2</code>.  Like <code>do.par=TRUE</code> but don't restore the
<code><a href="../../graphics/html/par.html">par</a></code> settings to their original state when
<code>plotres</code> exits, so you can add something to the plot.
<br />
<br />
</p>
</td></tr>
<tr valign="top"><td><code>caption</code></td>
<td>

<p>Overall caption.  By default create the caption automatically.
Use <code>caption=""</code> for no caption.
(Use <code>main</code> to set the title of an individual plot.)
</p>
</td></tr>
<tr valign="top"><td><code>trace</code></td>
<td>

<p>Default is <code>0</code>.
<br />
<code>trace=1</code> (or <code>TRUE</code>) for a summary trace (shows how
<code><a href="../../stats/html/predict.html">predict</a></code> and friends
are invoked for the model).
<br />
<code>trace=2</code> for detailed tracing.
<br />
</p>
</td></tr>
<tr valign="top"><td><code>npoints</code></td>
<td>

<p>Number of points to be plotted.
A sample of <code>npoints</code> is taken; the sample includes the biggest
twenty or so residuals.
<br />
The default is 3000 (not all, to avoid overplotting on large models).
Use <code>npoints=TRUE</code> or <code>-1</code> for all points.
</p>
</td></tr>
<tr valign="top"><td><code>center</code></td>
<td>

<p>Default is TRUE, meaning center the horizontal axis in the residuals plot,
so asymmetry in the residual distribution is more obvious.
</p>
</td></tr>
<tr valign="top"><td><code>type</code></td>
<td>

<p>Type parameter passed first to <code><a href="../../stats/html/residuals.html">residuals</a></code> and
if that fails to <code><a href="../../stats/html/predict.html">predict</a></code>.
For allowed values see the <code>residuals</code> and <code>predict</code> methods for
your <code>object</code>
(such as
<code><a href="../../rpart/html/residuals.rpart.html">residuals.rpart</a></code> or
<code><a href="../../earth/html/predict.earth.html">predict.earth</a></code>).
By default, <code>plotres</code> tries to automatically select a suitable
value for the model in question (usually <code>"response"</code>),
but this will not always be correct.
Use <code>trace=1</code> to see the <code>type</code> argument passed to
<code>residuals</code> and <code>predict</code>.
</p>
</td></tr>
<tr valign="top"><td><code>nresponse</code></td>
<td>

<p>Which column to use when <code>residuals</code> or <code>predict</code> returns
multiple columns.
This can be a column index or column name
(which may be abbreviated, partial matching is used).
</p>
</td></tr>
<tr valign="top"><td><code>object.name</code></td>
<td>

<p>The name of the <code>object</code> for error and trace messages.
Used internally by <code>plot.earth</code>.
<br />
<br />
</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>

<p>Dot arguments are passed to the plot functions.
Dot argument names, whether prefixed or not, should be specified in full
and not abbreviated.
</p>
<p>&ldquo;Prefixed&rdquo; arguments are passed directly to the associated function.
For example the prefixed argument <code>pt.col="pink"</code> passes
<code>col="pink"</code> to <code>points()</code>, overriding the global
<code>col</code> setting.
The prefixes recognized by <code>plotres</code> are:</p>

<table summary="Rd table">
<tr>
 <td style="text-align: left;">
<code>residuals.</code> </td><td style="text-align: left;"> passed to <code><a href="../../stats/html/residuals.html">residuals</a></code>
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>predict.</code> </td><td style="text-align: left;"> passed to <code><a href="../../stats/html/predict.html">predict</a></code>
(<code>predict</code> is called if the call to <code>residuals</code> fails)
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>w1.</code> </td><td style="text-align: left;"> sent to the model-dependent plot for <code>which=1</code> e.g. <code>w1.col=2</code>
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>pt.</code> </td><td style="text-align: left;"> modify the displayed points
e.g. <code>pt.col=as.numeric(survived)+2</code> or <code>pt.cex=.8</code>.
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>smooth.</code> </td><td style="text-align: left;"> modify the  smooth line e.g. <code>smooth.col=0</code> or
<code>smooth.f=.5</code>.
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>level.</code> </td><td style="text-align: left;"> modify the interval bands, e.g. <code>level.shade="gray"</code> or <code>level.shade2="lightblue"</code>
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>legend.</code> </td><td style="text-align: left;"> modify the displayed <code><a href="../../graphics/html/legend.html">legend</a></code> e.g. <code>legend.cex=.9</code>
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>cum.</code> </td><td style="text-align: left;"> modify the Cumulative Distribution plot
(arguments for <code><a href="../../stats/html/plot.stepfun.html">plot.stepfun</a></code>)
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>qq.</code> </td><td style="text-align: left;"> modify the QQ plot, e.g. <code>qq.pch=1</code>
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>qqline</code> </td><td style="text-align: left;"> modify the <code><a href="../../stats/html/qqnorm.html">qqline</a></code> in the QQ plot, e.g. <code>qqline.col=0</code>
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>label.</code> </td><td style="text-align: left;"> modify the point labels, e.g. <code>label.cex=.9</code> or <code>label.font=2</code>
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>cook.</code> </td><td style="text-align: left;"> modify the Cook's Distance annotations.
This affects only the leverage plot
(<code>versus=3</code>) for <code>lm</code> models with <code>standardize=TRUE</code>.
e.g. <code>cook.levels=c(.5, .8, 1)</code> or <code>cook.col=2</code>.
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>caption.</code> </td><td style="text-align: left;"> modify the overall caption (see the <code>caption</code> argument)
e.g. <code>caption.col=2</code>.
</td>
</tr>
<tr>
 <td style="text-align: left;">
<code>par.</code> </td><td style="text-align: left;"> arguments for <code><a href="../../graphics/html/par.html">par</a></code>
(only necessary if a <code>par</code> argument name clashes
with a <code>plotres</code> argument)
</td>
</tr>

</table>

<p>The <code>cex</code> argument is relative, so
specifying <code>cex=1</code> is the same as not specifying <code>cex</code>.
</p>
<p>For backwards compatibility, some dot
arguments are supported but not explicitly documented.
</p>
</td></tr>
</table>


<h3>Value</h3>

<p>If the <code>which=1</code> plot was plotted, the return value of that
plot (model dependent).
</p>
<p>Else if the <code>which=3</code> plot was plotted, return <code>list(x,y)</code>
where <code>x</code> and <code>y</code> are the coordinates of the points in that plot
(but without jittering even if the <code>jitter</code> argument was used).
</p>
<p>Else return <code>NULL</code>.
</p>


<h3>Note</h3>

<p>This function is designed primarily for displaying standard
<code>response - fitted</code> residuals for models
with a single continuous response,
although it will work for a few other models.
</p>
<p>In general this function won't work on models that don't save the call
and data with the model in a standard way.
It uses the same underlying mechanism to access the model data as
<code><a href="plotmo.html">plotmo</a></code>.
For further discussion please see &ldquo;<em>Accessing the model
data</em>&rdquo; in the <a href="../doc/plotmo-notes.pdf">plotmo vignette</a>.
Package authors may want to look at
<a href="../doc/modguide.pdf">Guidelines for S3 Regression Models</a>.
</p>


<h3>See Also</h3>

<p>Please see the <a href="../doc/plotres-notes.pdf">plotres vignette</a>.
</p>
<p><code><a href="../../stats/html/plot.lm.html">plot.lm</a></code>
</p>
<p><code><a href="../../earth/html/plot.earth.html">plot.earth</a></code>
</p>


<h3>Examples</h3>

<pre>
# we use lm in this example, but plotres is more useful for models
# that don't have a function like plot.lm for plotting residuals

lm.model &lt;- lm(Volume~., data=trees)

plotres(lm.model)
</pre>

<hr /><div style="text-align: center;">[Package <em>plotmo</em> version 3.2.0 <a href="00Index.html">Index</a>]</div>
</body></html>
