<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Negative Binomial Canonical Link Function</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for nbcanlink {VGAM}"><tr><td>nbcanlink {VGAM}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2> Negative Binomial Canonical Link Function </h2>

<h3>Description</h3>

<p>Computes the negative binomial canonical link transformation,
including its inverse and the first two derivatives.
</p>


<h3>Usage</h3>

<pre>
nbcanlink(theta, size = NULL, wrt.param = NULL, bvalue = NULL,
          inverse = FALSE, deriv = 0, short = TRUE, tag = FALSE)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>theta</code></td>
<td>

<p>Numeric or character.
Typically the mean of a negative binomial (NB) distribution.
See below for further details.
</p>
</td></tr>
<tr valign="top"><td><code>size, wrt.param</code></td>
<td>

<p><code>size</code> contains the <i>k</i> matrix which
must be of a conformable dimension as <code>theta</code>.
Also, if <code>deriv &gt; 0</code> then <code>wrt.param</code>
is either 1 or 2 (1 for with respect to the first
parameter, and 2 for with respect to the second
parameter (<code>size</code>)).
</p>
</td></tr>
<tr valign="top"><td><code>bvalue</code></td>
<td>

<p>Details at <code><a href="Links.html">Links</a></code>.
</p>
</td></tr>
<tr valign="top"><td><code>inverse, deriv, short, tag</code></td>
<td>

<p>Details at <code><a href="Links.html">Links</a></code>.
</p>
</td></tr>
</table>


<h3>Details</h3>

<p>The negative binomial (NB) canonical link is
<i>log(theta/(theta + k))</i>
where <i>theta</i> is the mean of a NB
distribution. The canonical link is used for theoretically
relating the NB to GLM class.
</p>
<p>This link function was specifically written for
<code><a href="negbinomial.html">negbinomial</a></code> and
<code><a href="negbinomial.size.html">negbinomial.size</a></code>,
and should not be used elsewhere
(these <span class="pkg">VGAM</span> family functions have code that
specifically handles <code>nbcanlink()</code>.)
</p>


<h3>Value</h3>

<p>For <code>deriv = 0</code>, the above equation
when <code>inverse = FALSE</code>, and if <code>inverse = TRUE</code> then
<code>kmatrix / expm1(-theta)</code>.
For <code>deriv = 1</code>, then the function returns
<em>d</em> <code>eta</code> / <em>d</em> <code>theta</code> as a function of <code>theta</code>
if <code>inverse = FALSE</code>,
else if <code>inverse = TRUE</code> then it returns the reciprocal.
</p>


<h3>Warning</h3>

<p>This function currently does not work very well with <code><a href="negbinomial.html">negbinomial</a></code>!
The NB-C model is sensitive to the initial values and may converge to a
local solution.
Pages 210 and 309 of Hilbe (2011) notes convergence difficulties (of
Newton-Raphson type algorithms), and this applies here.
This function should work okay with <code><a href="negbinomial.size.html">negbinomial.size</a></code>.
Currently trying something like <code>imethod = 3</code> or <code>imu</code>,
<code>stepsize = 0.5</code>, <code>maxit = 100</code>, <code>zero = -2</code> should help;
see the example below.
</p>
<p>Standard errors may be unreliable.
</p>


<h3>Note</h3>

<p>While theoretically nice, this function is not recommended
in general since its value is always negative (linear predictors
ought to be unbounded in general). A <code><a href="loge.html">loge</a></code>
link for argument <code>lmu</code> is recommended instead.
</p>
<p>Numerical instability may occur when <code>theta</code> is close to 0 or 1.
Values of <code>theta</code> which are less than or equal to 0 can be
replaced by <code>bvalue</code>
before computing the link function value.
See <code><a href="Links.html">Links</a></code>.
</p>


<h3>Author(s)</h3>

<p> Thomas W. Yee </p>


<h3>References</h3>

<p>Yee, T. W. (2014)
Reduced-rank vector generalized linear models with two linear predictors.
<em>Computational Statistics and Data Analysis</em>,
<b>71</b>, 889&ndash;902.
</p>
<p>Hilbe, J. M. (2011)
<em>Negative Binomial Regression</em>,
2nd Edition.
Cambridge: Cambridge University Press.
</p>


<h3>See Also</h3>

 
<p><code><a href="negbinomial.html">negbinomial</a></code>,
<code><a href="negbinomial.size.html">negbinomial.size</a></code>.
</p>


<h3>Examples</h3>

<pre>
nbcanlink("mu", short = FALSE)

mymu &lt;- 1:10  # Test some basic operations:
kmatrix &lt;- matrix(runif(length(mymu)), length(mymu), 1)
eta1 &lt;- nbcanlink(mymu, size = kmatrix)
ans2 &lt;- nbcanlink(eta1, size = kmatrix, inverse = TRUE)
max(abs(ans2 - mymu))  # Should be 0

## Not run:  mymu &lt;- c(seq(0.5, 10, length = 101))
kmatrix &lt;- matrix(10, length(mymu), 1)
plot(nbcanlink(mymu, size = kmatrix) ~ mymu, las = 1,
     type = "l", col = "blue", lwd = 1.5, xlab = expression({mu}))

# Estimate the parameters from some simulated data (see Warning section)
set.seed(123)
ndata &lt;- data.frame(x2 = runif(nn &lt;- 1000 ))
size1 &lt;- exp(1); size2 &lt;- exp(2)
ndata &lt;- transform(ndata, eta1 = -1 - 1 * x2,  # eta1 &lt; 0
                          size1 = size1,
                          size2 = size2)
ndata &lt;- transform(ndata,
            mu1 = nbcanlink(eta1, size = size1, inv = TRUE),
            mu2 = nbcanlink(eta1, size = size2, inv = TRUE))
ndata &lt;- transform(ndata, y1 = rnbinom(nn, mu = mu1, size = size1),
                          y2 = rnbinom(nn, mu = mu2, size = size2))
head(ndata)
summary(ndata)

fit &lt;- vglm(cbind(y1, y2) ~ x2,
#           negbinomial("nbcanlink", imethod = 1, max.chunk.MB = 9),
            negbinomial("nbcanlink", imethod = 2),
            stepsize = 0.25, data = ndata,  # Deliberately slow the convergence rate
            maxit = 100, trace = TRUE)  # Warning: may converge to a local soln
coef(fit, matrix = TRUE)
summary(fit)

## End(Not run)
</pre>

<hr /><div style="text-align: center;">[Package <em>VGAM</em> version 1.0-2 <a href="00Index.html">Index</a>]</div>
</body></html>
