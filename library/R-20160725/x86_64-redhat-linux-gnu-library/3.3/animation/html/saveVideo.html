<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Convert a sequence of images to a video by FFmpeg</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for saveVideo {animation}"><tr><td>saveVideo {animation}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Convert a sequence of images to a video by FFmpeg</h2>

<h3>Description</h3>

<p>This function opens a graphics device to record the images produced in the
code <code>expr</code>, then uses FFmpeg to convert these images to a video.
</p>


<h3>Usage</h3>

<pre>
saveVideo(expr, video.name = "animation.mp4", img.name = "Rplot", 
    ffmpeg = ani.options("ffmpeg"), other.opts = if (grepl("[.]mp4$", 
        video.name)) "-pix_fmt yuv420p", ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>expr</code></td>
<td>
<p>the R code to draw (several) plots</p>
</td></tr>
<tr valign="top"><td><code>video.name</code></td>
<td>
<p>the file name of the output video (e.g.
&lsquo;<span class="file">animation.mp4</span>&rsquo; or &lsquo;<span class="file">animation.avi</span>&rsquo;)</p>
</td></tr>
<tr valign="top"><td><code>img.name</code></td>
<td>
<p>the file name of the sequence of images to be generated</p>
</td></tr>
<tr valign="top"><td><code>ffmpeg</code></td>
<td>
<p>the command to call FFmpeg (e.g.
<code>'C:/Software/ffmpeg/bin/ffmpeg.exe'</code> under Windows or 'avconv' on some linux machines); note the full
path of FFmpeg can be pre-specified in <code><a href="ani.options.html">ani.options</a>('ffmpeg')</code></p>
</td></tr>
<tr valign="top"><td><code>other.opts</code></td>
<td>
<p>other options to be passed to <code>ffmpeg</code>, e.g. we can
specify the bitrate as <code>other.opts = '-b 400k'</code> (The default <code>"-pix_fmt yuv420p"</code> is a work-around for a bug in some versions of ffmpeg.)</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>other arguments to be passed to <code><a href="ani.options.html">ani.options</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>This function uses <code><a href="../../base/html/system.html">system</a></code> to call FFmpeg to convert the images
to a single video. The command line used in this function is: <code>ffmpeg
-y -r &lt;1/interval&gt; -i &lt;img.name&gt;%d.&lt;ani.type&gt; other.opts video.name</code>
</p>
<p>where <code>interval</code> comes from <code>ani.options('interval')</code>, and
<code>ani.type</code> is from <code>ani.options('ani.type')</code>. For more details on
the numerous options of FFmpeg, please see the reference.
</p>
<p>Some linux systems may use the alternate software 'avconv' instead of 'ffmpeg'.  The package will attempt to determine which command is present and set <code><a href="ani.options.html">ani.options</a>('ffmpeg')</code> to an appropriate default value. This can be overridden by passing in the <code>ffmpeg</code> argument.
</p>


<h3>Value</h3>

<p>An integer indicating failure (-1) or success (0) of the converting
(refer to <code><a href="../../base/html/system.html">system</a></code>).
</p>


<h3>Note</h3>

<p>There are a lot of possibilities in optimizing the video. My knowledge
on FFmpeg is very limited, hence the default output by this function could
be of low quality or too large. The file &lsquo;<span class="file">presets.xml</span>&rsquo; of WinFF might
be a good guide: <a href="http://code.google.com/p/winff/">http://code.google.com/p/winff/</a>.
</p>


<h3>Author(s)</h3>

<p>Yihui Xie, based on an inital version by Thomas Julou
<a href="mailto:thomas.julou@gmail.com">thomas.julou@gmail.com</a>
</p>


<h3>References</h3>

<p><a href="http://ffmpeg.org/documentation.html">http://ffmpeg.org/documentation.html</a>
</p>


<h3>See Also</h3>

<p>Other utilities: <code><a href="convert.html">gm.convert</a></code>,
<code><a href="convert.html">im.convert</a></code>; <code><a href="saveGIF.html">saveGIF</a></code>,
<code><a href="saveGIF.html">saveMovie</a></code>; <code><a href="saveHTML.html">saveHTML</a></code>;
<code><a href="saveLatex.html">saveLatex</a></code>; <code><a href="saveSWF.html">saveSWF</a></code>
</p>


<h3>Examples</h3>

<pre>
oopts = if (.Platform$OS.type == "windows") {
    ani.options(ffmpeg = "D:/Installer/ffmpeg/bin/ffmpeg.exe")
}
## usually Linux users do not need to worry about the ffmpeg path as long as
## FFmpeg or avconv has been installed

saveVideo({
    par(mar = c(3, 3, 1, 0.5), mgp = c(2, 0.5, 0), tcl = -0.3, cex.axis = 0.8, 
        cex.lab = 0.8, cex.main = 1)
    ani.options(interval = 0.05, nmax = 300)
    brownian.motion(pch = 21, cex = 5, col = "red", bg = "yellow")
}, video.name = "BM.mp4", other.opts = "-pix_fmt yuv420p -b 300k")
# higher bitrate, better quality

ani.options(oopts)
</pre>

<hr /><div style="text-align: center;">[Package <em>animation</em> version 2.4 <a href="00Index.html">Index</a>]</div>
</body></html>
